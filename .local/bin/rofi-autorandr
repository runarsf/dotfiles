#!/usr/bin/env bash
set -o errexit

profiles_prefix=""
profiles_suffix="\n(Auto)\n(Select default profile)\n(Select profile to remove)\n(Save current layout as profile)"
profiles="$(\ls ~/.config/autorandr)"
lines=$(($(printf "${profiles}" | wc -l) + 1))
lines_full=$(($(printf "${profiles_prefix}${profiles}${profiles_suffix}" | wc -l) + 1))
profile="$(printf "${profiles_prefix:-}${profiles}${profiles_suffix:-}" | rofi -theme-str "configuration { fixed-num-lines: true; } listview { lines: ${lines_full}; }" -dmenu -p 'Select profile')"

case "${profile}" in
  '(Auto)') autorandr --change;;
  '(Save current layout as profile)')
    profile_name="$(rofi -theme-str "configuration { fixed-num-lines: true; } listview { lines: 0; }" -dmenu -i  -p 'Enter profile name: ')"
    autorandr --save "${profile_name}";;
  '(Select default profile)')
    profile_name="$(printf "${profiles}" | rofi -theme-str "configuration { fixed-num-lines: true; } listview { lines: ${lines}; }" -dmenu -p 'Select profile')"
    autorandr --default "${profile_name}";;
  '(Select profile to remove)')
    profile_name="$(printf "${profiles}" | rofi -theme-str "configuration { fixed-num-lines: true; } listview { lines: ${lines}; }" -dmenu -p 'Select profile')"
    autorandr --remove "${profile_name}";;
  *) autorandr --load "${profile}";;
esac
