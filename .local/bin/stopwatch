#!/usr/bin/env bash

START=$(date +%s)

printf "%s\n" "Starting Stopwatch..."
printf "%s\n\n" "[q]uit, [s]plit"

SPLIT=""
while true; do
  NOW="$(date +%s)"
  let DIFF="$((${NOW} - ${START}))"
  let MINS="$((${DIFF} / 60))"
  let SECS="$((${DIFF} % 60))"
  let HOURS="$((${DIFF} / 3600))"
  let DAYS="$((${DIFF} / 86400))"

  MESSAGE="$(printf "\r%3dD %02d:%02d:%02d%s\033[K" \
    "${DAYS}" \
    "${HOURS}" \
    "${MINS}" \
    "${SECS}" \
    "${SPLIT:+ (}${SPLIT:-}${SPLIT:+)}" \
  )"
  printf "%s" "${MESSAGE}"

  read -t 0.25 -N 1 INPUT
  if test "${INPUT,,}" = "q"; then
    printf "%s\n" "${MESSAGE}"
    break
  elif test "${INPUT,,}" = "s"; then
    # \033 - Esc
    #     [1A - move cursor to previous line
    #     [K  - erase rest of line
    #     [2K - erase line
    printf "\r  Split: \033[K"
    read SPLIT
    printf "\033[1A\033[2K"
  fi
done
