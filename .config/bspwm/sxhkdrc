# bspwm-specific sxhkd config, extends ~/.config/sxhkd/sxhkdrc

# https://www.reddit.com/r/bspwm/comments/6nclzv/presel_border_toolscript/
# https://www.reddit.com/r/bspwm/comments/ceu0za/help_with_sxhkdrc_config_for_multiple_monitors/
# bspc monitor -f next

# All bspwm-related scripts are located in ~/.config/bspwm/scripts/
# Added to PATH in ~/.profile

super + {_,shift + }q
	bspc node --{close,kill}

# super + <number> = focus the given desktop
# super + shift + <number> = send focused window to given desktop
# super + ctrl + shift + <number> = as above, but send to next monitor
# super + ctrl + <number> = switches the active (visible) desktop of the
# --ns -> --nsf & --nm -> --nmf to follow node
super + {_,shift + ,ctrl + shift +,ctrl +}{0-9}
	;bspwm_dynamic_desktops {--df,--ns,--nm,--da} {0-9}

# super + {0-9}
# 	bspc desktop --focus '{0-9}'

# super + shift + {0-9} + {_,alt}
# 	bspc node --to-desktop '{0-9}' { ,--follow}

super + shift + Return
	bspc node --swap biggest

# Focus last active node/desktop on active monitor
super + {_,shift + }Tab
	bspc {node,desktop} --focus last.local

super + {Left,Down,Up,Right}
	bspcfg focus {west,south,north,east}
#	bspwm_focus {west,south,north,east}
# super + {h,j,k,l}
# 	bspwm_focus {west,south,north,east}

super + shift + {Left,Down,Up,Right}
	bspwm_smart_move {west,south,north,east}
# super + shift + {Left,Down,Up,Right}
# 	bspwm_move {west,south,north,east}
# super + shift + {h,j,k,l}
# 	bspwm_move {west,south,north,east}

# TODO Fix resizing of floating nodes
super + ctrl + {Left,Down,Up,Right}
	bspwm_smart_resize {west,south,north,east} 50
# super + ctrl + {Left,Down,Up,Right}
# 	{bspc node @parent/second --resize left  -20 0; \
# 	 bspc node @parent/first  --resize right -20 0, \
# 	 bspc node @parent/second --resize top    0 +20; \
# 	 bspc node @parent/first  --resize bottom 0 +20, \
# 	 bspc node @parent/first  --resize bottom 0 -20; \
# 	 bspc node @parent/second --resize top    0 -20, \
# 	 bspc node @parent/first  --resize right +20 0; \
# 	 bspc node @parent/second --resize left  +20 0}

super + @space
	bspc desktop --layout next

super {_,shift + ,alt + }f
	bspc node --state \~{fullscreen,floating,pseudo_tiled}

# Toggle master/stack layout
super + shift + space
	did="$(bspc query -D -n focused --names)"; layout="$(bsp-layout get ${did})"; test "${layout}" = "-" -o "${layout}" = "tile" && bsp-layout set tall "${did}" --master-size 0.55 || {bsp-layout remove "${did}"; bsp-layout once tile}

super + shift + r
	bspc wm --restart

super + shift + e
	prompt "Exit bspwm?" "bspc quit"

super + shift + b
	toggleprogram "bspwm_double_borders"

super + n
	bspwm_scratchpad "scratchpad" "alacritty --class scratchpad --title scratchpad --option font.size=14 --command tmux new-session -A -s scratchpad" "1600x1000+0+0"
super + m
	bspwm_scratchpad "math" "alacritty --class math --title math --option font.size=18 --command tmux new-session -A -s math xonsh" "1200x800+0+0"

super + alt + {minus,plus}
	bspc config --desktop focused window_gap $((`bspc config --desktop focused window_gap` {+,-} 2 ))
super + alt + shift + plus
	bspc config --desktop focused window_gap 0

super + alt + {Left,Down,Up,Right}
	bspc node --presel-dir {west,south,north,east}

# Move active node to preselection
super + alt + Return
	bspc node --to-node last.!automatic

# Cancel all preselections on active desktop
super + alt + space
	bspc query -N -d | xargs -I id -n 1 bspc node id -p cancel

# Insert receptacle
super + alt + ctrl + {Left,Down,Up,Right}
	bspc node --presel-dir {west,south,north,east} --insert-receptacle

# Close all receptacles
super + alt + ctrl + space
	for win in `bspc query -N -n .leaf.\!window`; do bspc node $win -k; done;

# Move to receptacle
super + alt + ctrl + Return
	bspc node $(bspc query -N -n focused) -n $(bspc query -N -n .leaf.\!window)

super + x ; f ; {l,m,s,p}
	bspc node -g {locked,marked,sticky,private}

# Other neat binds {{{

# https://gitlab.com/protesilaos/dotfiles/-/blob/master/xorg-twm/.config/sxhkd/sxhkdrc_bspc

# Balance nodes
# super + e
# 	bspc node @/ -B

# Focus the older or newer node in the focus history
# super + {o,i}
# 	bspc wm -h off; \
# 	bspc node {older,newer} -f; \
# 	bspc wm -h on

# Focus the node for the given path jump
# super + {p,b,comma,period}
# 	bspc node -f @{parent,brother,first,second}

# super + alt + {1-9}
# 	bspc node --presel-ratio 0.{1-9}

# Change focus or move container
# super + alt + {Left,Right}
# 	desk=`bspc query -D -d focused`; \
# 	bspc desktop -m {prev,next}; \
# 	bspc monitor -f {prev,next}; \
# 	bspc desktop -f $desk

# }}}
